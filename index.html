<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SHΞNematic™ - VEO Video Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Cropper.js for image cropping -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.22.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
    <style>
      body {
        background-color: #121212;
        color: #E0E0E0;
      }
      .shen-border { border: 1px solid rgba(255, 255, 255, 0.1); }
      .shen-bg-dark { background-color: #1E1E1E; }
      .shen-bg-light { background-color: #2a2a2a; }
      .shen-input { background-color: #252525; border: 1px solid #444; }
      .shen-input:focus { border-color: #7c3aed; box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.4); }
      .shen-button-primary { background-color: #7c3aed; color: white; }
      .shen-button-primary:hover { background-color: #6d28d9; }
      .shen-button-primary:disabled { background-color: #4c1d95; cursor: not-allowed; }
      .shen-button-secondary { background-color: #333; color: #E0E0E0; }
      .shen-button-secondary:hover { background-color: #444; }
      .shen-button-toggle[aria-pressed="true"] { background-color: #7c3aed; color: white; border-color: #7c3aed; }
      .modal-content { animation: fadeIn 0.3s ease-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
      .wavy-title {
        font-weight: 800;
        background: linear-gradient(90deg, #fff, #999, #fff);
        background-size: 200% auto;
        color: #fff;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: wave 3s linear infinite;
      }
      @keyframes wave { to { background-position: 200% center; } }
      .prompt-textarea { max-height: 200px; }
      .prompt-textarea::-webkit-scrollbar { width: 8px; }
      .prompt-textarea::-webkit-scrollbar-track { background: #2a2a2a; border-radius: 4px; }
      .prompt-textarea::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
      .prompt-textarea::-webkit-scrollbar-thumb:hover { background: #666; }
      .loader {
        width: 18px;
        height: 18px;
        border: 2px solid #FFF;
        border-bottom-color: transparent;
        border-radius: 50%;
        display: inline-block;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
      }
      @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      #cropper-container { height: 60vh; }
      #cropper-container > img { max-height: 100%; }
      fieldset:disabled { opacity: 0.5; pointer-events: none; }
    </style>
  </head>
  <body class="font-sans">

    <!-- HIDDEN FILE INPUT for all image uploads -->
    <input type="file" id="image-file-input" class="hidden" accept="image/*">

    <!-- MODALS -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/80 z-40 hidden"></div>

    <!-- API Key Modal -->
    <div id="api-key-modal" class="fixed inset-0 flex items-center justify-center z-50 p-4 hidden">
      <div class="shen-bg-dark shen-border rounded-2xl shadow-xl max-w-md w-full p-6 modal-content">
        <h3 class="text-xl font-bold text-white mb-2">تنظیم کلید API</h3>
        <p class="text-gray-400 text-sm mb-4">
            برای استفاده از برنامه، به کلید Gemini API نیاز دارید. کلید شما به صورت محلی در مرورگر ذخیره می‌شود و به هیچ سروری ارسال نمی‌گردد.
        </p>
        <div class="flex flex-col gap-2">
          <label for="api-key-input" class="text-sm font-medium text-gray-300">کلید API شما:</label>
          <input type="password" id="api-key-input" class="w-full shen-input rounded-lg p-2 text-base" placeholder="کلید خود را اینجا وارد کنید...">
          <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-sm text-purple-400 hover:underline self-start">دریافت کلید API</a>
        </div>
        <div class="flex justify-end mt-6">
          <button id="save-api-key-button" class="px-6 py-2 shen-button-primary font-semibold rounded-lg">ذخیره و شروع</button>
        </div>
      </div>
    </div>

    <!-- Help Tooltip Modal -->
    <div id="help-modal" class="fixed inset-0 flex items-center justify-center z-50 p-4 hidden">
        <div class="shen-bg-dark shen-border rounded-2xl shadow-xl max-w-md w-full p-6 modal-content">
            <div class="flex justify-between items-start mb-4">
                <h3 id="help-modal-title" class="text-xl font-bold text-white"></h3>
                <button id="help-modal-close" class="text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            </div>
            <p id="help-modal-content" class="text-gray-300"></p>
            <p id="help-modal-status" class="text-center text-xl font-bold mt-4"></p>
        </div>
    </div>
    
    <!-- General Guide Modal -->
    <div id="guide-modal" class="fixed inset-0 flex items-center justify-center z-50 p-4 hidden">
        <div class="shen-bg-dark shen-border rounded-2xl shadow-xl max-w-2xl w-full p-6 modal-content flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-white">راهنمای استودیو</h3>
                <button id="guide-modal-close" class="text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
            </div>
            <div class="text-gray-300 space-y-4 overflow-y-auto max-h-[70vh] pr-2">
                <p>به SHΞNematic™، استودیوی هوشمند ساخت ویدیو خوش آمدید. این راهنما به شما در استفاده از تمام قابلیت‌ها کمک می‌کند:</p>
                <div class="space-y-3">
                  <h4 class="text-lg font-semibold text-purple-400">۱. پرامپت (دستور متنی)</h4>
                  <p>ایده اصلی ویدیوی خود را در باکس اصلی بنویسید. سعی کنید واضح و خلاق باشید. با کلیک روی دکمه ♻️ پرامپت خود را حرفه‌ای کنید.</p>
                  
                  <h4 class="text-lg font-semibold text-purple-400">۲. افزونه‌های جلوه‌های ویژه</h4>
                  <p>با کلیک روی دکمه‌های زیر باکس متن، می‌توانید جلوه‌های سینمایی حرفه‌ای مانند "Drone shot" یا "Slow motion" را به پرامپت خود اضافه کنید.</p>
                  
                  <h4 class="text-lg font-semibold text-purple-400">۳. استفاده از تصویر</h4>
                  <p>شما دو گزینه دارید: یا یک تصویر از سیستم خود <span class="font-bold">بارگذاری</span> کنید، یا با استفاده از گزینه <span class="font-bold">خلق تصویر با AI</span> یک تصویر جدید بسازید. پس از افزودن، می‌توانید نقش آن را (فریم شروع، پایان یا مرجع) مستقیماً روی خود تصویر مشخص کنید.</p>
                  
                  <h4 class="text-lg font-semibold text-purple-400">۴. ساخت و دریافت ویدیو</h4>
                  <p>پس از تنظیم پرامپت و تصاویر (اختیاری)، روی دکمه "ساخت ویدیو" کلیک کنید. ویدیوهای ساخته شده در گالری پایین صفحه ظاهر می‌شوند.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Cropper Modal -->
    <div id="cropper-modal" class="fixed inset-0 flex items-center justify-center z-50 p-4 hidden">
      <div class="shen-bg-dark shen-border rounded-2xl shadow-xl max-w-4xl w-full p-6 modal-content">
        <h3 class="text-xl font-bold text-white mb-4">برش تصویر (نسبت ۱۶:۹)</h3>
        <div id="cropper-container" class="mb-4 bg-black flex justify-center items-center rounded-lg overflow-hidden">
          <!-- Image will be inserted here by JS -->
        </div>
        <div class="flex justify-end gap-4">
          <button id="cancel-crop-button" class="px-4 py-2 shen-button-secondary rounded-lg">انصراف</button>
          <button id="confirm-crop-button" class="px-4 py-2 shen-button-primary rounded-lg">تایید و افزودن</button>
        </div>
      </div>
    </div>
    
    <!-- Image Generation Modal -->
    <div id="image-gen-modal" class="fixed inset-0 flex items-center justify-center z-50 p-4 hidden">
        <div class="shen-bg-dark shen-border rounded-2xl shadow-xl max-w-2xl w-full p-6 modal-content flex flex-col gap-4">
          <div class="flex justify-between items-center">
              <h3 class="text-xl font-bold text-white">خلق تصویر با هوش مصنوعی</h3>
              <button id="image-gen-close-button" class="text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
          </div>
          <div id="image-gen-display" class="w-full aspect-video bg-black/50 shen-border rounded-lg flex items-center justify-center text-gray-500">
              <!-- Image or loader will be inserted here -->
              <span>تصویر شما اینجا ساخته می‌شود</span>
          </div>
          <div>
              <label for="image-gen-prompt" class="text-sm font-medium text-gray-400 block mb-1">پرامپت برای ساخت تصویر:</label>
              <textarea id="image-gen-prompt" class="w-full shen-input rounded-lg p-2 text-base resize-none" rows="2" placeholder="یک ربات که اسکیت‌بورد قرمز در دست دارد..."></textarea>
          </div>
          <div class="flex justify-end gap-4">
              <div id="image-gen-actions" class="flex items-center gap-4 hidden">
                   <button id="regenerate-image-button" class="px-4 py-2 shen-button-secondary rounded-lg">ساخت مجدد</button>
                   <button id="transfer-image-button" class="px-4 py-2 shen-button-primary rounded-lg">انتقال به پروژه</button>
              </div>
               <button id="image-gen-button" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg">ساخت تصویر</button>
          </div>
        </div>
      </div>

    <!-- Main Application UI -->
    <div id="main-app" class="h-screen flex flex-col">
      <header class="py-4 px-8 flex justify-between items-center z-10 shrink-0">
        <h1 class="text-4xl md:text-5xl tracking-wide wavy-title">SHΞNematic™</h1>
        <div class="flex items-center gap-2">
            <button id="change-api-key-button" class="p-2 shen-button-secondary rounded-full" title="تغییر کلید API">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M12.75 20.25H3.75A2.25 2.25 0 0 1 1.5 18V9.75A2.25 2.25 0 0 1 3.75 7.5H12.75V6H3.75A3.75 3.75 0 0 0 0 9.75V18A3.75 3.75 0 0 0 3.75 21.75H12.75A2.25 2.25 0 0 1 15 19.5V18h-2.25v2.25ZM15.841 4.523a3.375 3.375 0 0 1 4.773 0l1.856 1.856a3.375 3.375 0 0 1 0 4.773l-1.121 1.121-6.629-6.629 1.121-1.121ZM14.06 6.303 7.432 12.932l-1.251 3.752 3.752-1.251 6.628-6.628-2.502-2.502Z" /></svg>
            </button>
            <button id="open-guide-button" class="p-2 shen-button-secondary rounded-full hover:bg-purple-500/20 text-2xl" title="راهنما">
                🤔
            </button>
        </div>
      </header>

      <div class="flex-grow min-h-0 overflow-y-auto">
        <fieldset id="main-controls-fieldset">
            <div class="w-full max-w-4xl mx-auto flex flex-col gap-6 p-4">
            
            <!-- Prompt & Generation -->
            <div class="shen-bg-dark shen-border rounded-2xl p-4 flex flex-col gap-3">
                <label for="prompt-input" class="text-xl font-bold">۱. پرامپت خود را بنویسید</label>
                <div class="relative">
                    <textarea id="prompt-input" class="w-full shen-input rounded-lg p-3 text-lg leading-relaxed resize-none transition-all duration-300 prompt-textarea" rows="4" placeholder="ایده اصلی ویدیوی خود را اینجا بنویسید..."></textarea>
                    <div class="absolute top-2 left-2 flex flex-col gap-2">
                        <button id="copy-prompt-button" class="p-2 shen-button-secondary rounded-full text-gray-400 hover:text-white text-xl" title="کپی کردن پرامپت">
                            📑
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="enhance-prompt-button" class="px-4 py-2 shen-button-primary rounded-lg flex-grow flex items-center justify-center gap-2 transition-all duration-300 hover:scale-105 disabled:bg-gray-600 disabled:cursor-not-allowed" title="مهندسی پرامپت">
                        <span id="enhance-prompt-icon" class="text-xl">
                            ♻️
                        </span>
                        <span>بهبود پرامپت</span>
                    </button>
                </div>
                <div class="mt-2">
                    <label class="text-sm font-medium text-gray-400 block mb-2">افزونه های جلوه‌های ویژه:</label>
                    <div id="creative-prompts-container" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
            
            <!-- Media Upload Section -->
            <div class="shen-bg-dark shen-border rounded-2xl p-4 flex flex-col gap-3">
                <h2 class="text-xl font-bold">۲. بارگذاری تصویر (اختیاری)</h2>
                <p class="text-sm text-gray-400 -mt-2">برای کنترل ابتدا/انتها یا تعیین سبک از تصویر استفاده کنید.</p>
                <div id="media-upload-controls" class="flex flex-wrap gap-4">
                <!-- Upload buttons will be inserted here by JS -->
                </div>
                <div id="media-gallery" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-2 min-h-[8rem]">
                <!-- Media previews will be inserted here by JS -->
                </div>
            </div>

            <!-- Generate Button -->
            <button id="generate-button" class="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition-colors text-xl disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-3">
                <span id="generate-button-icon" class="text-2xl">
                🎬
                </span>
                <span id="generate-button-text">ساخت ویدیو</span>
            </button>
            
            <div class="mt-4">
                <h2 class="text-2xl font-bold mb-4">گالری نتایج</h2>
                <div id="results-gallery" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Results will be inserted here -->
                </div>
            </div>
            </div>
        </fieldset>
      </div>
      
      <footer class="text-center p-4 text-xs text-gray-600 shrink-0">
        <a href="https://t.me/shervini" target="_blank" rel="noopener noreferrer" class="hover:text-purple-400">Exclusive SHΞN™ made</a>
      </footer>
    </div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>